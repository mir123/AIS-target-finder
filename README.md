# AIS Target Finder

> This is a simple utility used find desired MMSI targets in AIS data that has been received (from a TCP or UDP network feed, but can be modified to use serial). 

It consists of two scripts.

```listen.sh``` and ```sort.sh```

```listen.sh``` receives AIS traffic information and continuously writes it to ```datastream.csv```

```sort.sh``` compares ```datastream.csv``` with ```targets.list``` and emails a report of matched targets.

The ```listen.sh``` script should run continuously to listen for AIS traffic. All AIS traffic received is continuously 
appended to the ```datastream.csv``` file. It uses netcat (```nc```), and can receive TCP and UDP streams. 

The ```sort.sh``` script should be run periodically. It will generate an email containing matching targets, and a GPX file which
can be viewed in Google Earth or OpenCPN. Each time it runs it archives current data and resets ```datastream.csv```

## Launching the listner

The ```listen.sh``` script is launched once, and will keep running as long as your terminal session is active.
If you have to listen for an extended period of time and you don't want the terminal session to die because
eg. your laptop is running out of power, the best thing to do is to use 'screen'.

Screen will make a terminal session that you can attach to and deattach whenever it suits you, regardless of
what computer you're accessing it from or if your power suddenly goes off.

To create a new screen session simply type in

```
~$ screen
```

Once you are inside your screen session type in

```
~$ cd /home/ais/ais/
~$ ./listen.sh
```

Once it's running, you can 'detach' the screen by pressing "Ctrl-A" and then "D"

To reattach to the screen type in 

```
~$ screen -r
```

## Checking to see if the listener is receiving data

You can 'tail' the datastream.csv file to see if any data is arriving.

```
~$ tail -f datastream.csv
```

You should see something like the following updating every few seconds:

"2016/05/27","11:50:10",6645040,-4.6124,55.4681,0,252.7
"2016/05/27","11:50:10",226240000,-4.6221,55.4617,0,323.7
"2016/05/27","11:50:10",664393000,-4.6116,55.4672,0,229.3
"2016/05/27","11:50:10",466175000,-4.5321,55.1678,10.7,275.9

## Specifying your targets

Targets are contained in the ```targets.list``` file.

The format for the file is :

mmsi,"plaintext_name"

The MMSI is just numbers without quotes.
The plaintext name must not contain any spaces, and should be surrounded by quotes.

For example

645374000,"BELLE_ISLE"
645378000,"BLUE_OCEAN_110"
645379000,"BLUE_OCEAN_111"

## Running sort.sh

Each time you run sort.sh it will see if it can find anything interesting in the
data received up to that point. It will generate an email containing some text 
about the targets, and it will also attach a GPX file that will show you where 
they were last seen. To specify which email addresses should receive the report
simply open sort.sh with your favourite editor.

You can either run sort.sh by hand every now and then, or you can have it run 
automatically at times you specify. 

## To run it by hand, simply type in the following:

```
~$ cd /home/ais/ais/
~$ ./sort.sh
```

You should receive an email shortly (provided mailx is set up correctly!).

## To automatically run the script at set times, edit the crontab for the relevant user

```
~$ crontab -e
```

(Note : This usually launches vi as the editor. It works a bit differently from normal text editors. 

Crash course: 

To start writing press ```i```
Once you are done press 'ESC', then type in ```:wq```
)

An example crontab looks like this:

45 07 * * * /home/ais/ais/sort.sh >> /home/ais/ais/log
45 11 * * * /home/ais/ais/sort.sh >> /home/ais/ais/log
00 16 * * * /home/ais/ais/sort.sh >> /home/ais/ais/log

This will run the script at 07:45, 11:45 and 16:00 system time, and write a log to ```/home/ais/ais/log```

## Files generated by ```sort.sh```

The data files generated when you run are:

```ddmmyy-time.gpx``` - contains last know position of all found targets
```mail.txt``` - contains the text of the email
```lastseen.txt``` - a CSV formatted file used internally by the script
```currentships/MMSI,"name"``` - A file containing all information received for each target - could be used to make a track for example

After each run all data from the previous run is moved into the ```./archive``` folder.
Might be worth cleaning that out periodically to save disk space.

Hope this helps!


